{% extends "layout.html" %}

{% block head_js %}
<script src='https://www.google.com/recaptcha/api.js?onload=recaptchaLoaded&render=explicit' async defer></script>
<script>
var gReCaptchaValidated = function() {
  $("input[type=submit]").removeAttr('disabled');
};

var gReCaptchaExpired = function() {
  $("input[type=submit]").attr('disabled','disabled');
};

var recaptchaLoaded = function() {
  grecaptcha.render('recaptcha', {
    'sitekey': '{{ recaptcha_key }}',
    'callback': gReCaptchaValidated,
    'expired-callback': gReCaptchaExpired
  });
  console.info("recaptcha rendered");
  pymChild.sendHeight();
};

var persons = {{ persons_json|safe }};
</script>
{% endblock head_js %}

{% block title %}Send a message to a Member of Parliament{% endblock %}
{% block content %}

<section class="hero">
  <h1>Statement</h1>
  <h3>Send a message to a member of parliament</h3>
</section>

<form id="email-form" action="/email/" method="post">
  {% csrf_token %}

  <section class="choose">
    <div class="row">
    {% for person in neglected_persons %}
      <div class="col-xs-6 col-sm-3 mp-wrap">
        <div class="single-mp">
          <div class="mp-img-wrapper center-block" style="background-image:url({% if person.portrait_url %}{{ person.portrait_url }}{% else %}https://taxdisclosure.org/img/default.svg{% endif %})">
            {% if person.party %}
            <img class="party-logo" src="http://www.pa.org.za/static/images/party-map-icons/{{ person.party.slug }}.png" alt="Logo of {{ person.party.name }}">
            {% endif %}
          </div>
          <div class="mp-name">
            {{ person.name }}
          </div>
          {% for branch in person.constituency_branches.all %}
          <p>{{ branch.name }}</p>
          {% endfor %}
          <div class="email-count">
            <small>{% if person.num_emails == 0 %}No emails sent yet{% else %}emailed {{ person.num_emails }} times{% endif %}</small>
          </div>
          <p>
          </p>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <div>
    <select class="selectpicker" data-live-search="true" title="Choose MP by name or Party">
      {% for person in persons %}
      <option value="{{ person.id }}">
        {{ person.name }}
        {% if person.party %}
        - {{ person.party.name }}
        {% endif %}
      </option>
      {% endfor %}
    </select>
  </div>
  <div>Subject: <input type="text" name="subject" value="Message to you rudy"></div>
  <div>
    <textarea name="body"  class="form-control">I feel very strongly.</textarea>
  </div>

  <div>Your name: <input type="text" name="from_name"></div>
  <div>Your email address: <input type="text" name="from_email"></div>
  <div id="recaptcha"></div>
  <div>
    <input type="submit" value="Submit" disabled="disabled">
  </div>
</form>

<br>
{% endblock content %}

{% block attribution %}
<div>
  <ul>
    <li><a target="_blank" href="https://www.flickr.com/photos/michaelhebb/5701999088/in/photolist-6hsFjU-AoRjc-8nh5Q4-Ei6m71-snzer1-6X1Hmi-5qNmgc-dR3XzP-dR9vS3-8D9MUS-o4gXBt-6X8zLZ-i7CXHn-dpirUa-d59QMG-5x36Di-Rk6sq5-RDE4gy-den4Ck-bUtToB-51XW6w-9dA2fi-brAo43-f81cpu-nM6SXn-aqhWae-8NtUJA-o4tMVU-hcRBHM-KRXgC-p8F6Yf-nJsf5S-9hhpEr-o4thB1-s6bgRP-o6nz9v-ia7fFM-BLJjRH-ky2WRx-8ebe5L-9FSeF7-6Up7gM-qw5s5D-s84xhT-sp2iLu-iKDgoU-kCi7r9-8boVRg-aJ4ex4-i7QhBe">Photo by Michael Hebb</a> is licensed under <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/2.0/legalcode">CC BY-NC-SA 2.0</a>
    <li><a target="_blank" href="https://www.flickr.com/photos/richardatuct/5425424966/in/photolist-9gqHPL-s9Jtk1-soZY9q-RDE4gy-sri5yx-aqhWae-sri6Yg-9FSeF7-p8F6Yf-s9HPJ9-as7CnR-8dtafz-sp1A89-ruidiu-s9JUth-ruuYSr-s9HQeh-sp18Ph-s7YCmD-s9RAba-s9RLeB-s9Jna5-ruvpAe-s9HTtb-srgspr-sp2i8L-s9HSnA-pNKkWy-s7YH68-ruhLxS-6o1EuJ-srizy6-aqkAEE-s9QZxx-aqkErw-hcdkfu-sp1HXN-322Eji-7BHKcp-55AJso-9ASXva-s9J8zj-7DT1Pr-s7Y3bV-6RzaL3-aqkJ5b-8faxN7-sp1uWh-etpXGk-xZ5h84">"Parliaments Behind" by Richard Atkinson</a> is licensed under <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/2.0/legalcode">CC BY-NC-SA 2.0</a>
    <li><a target="_blank" href="http://www.pa.org.za/help/api">Member of Parliament data compiled by People's Assembly</a> is licensed under <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC BY-SA 4.0</a>
  </ul>
</div>
{% endblock attribution %}
